# ๐ง ุฅุตูุงุญ ูุดููุฉ Stored Procedures

## ๐ ุงููุดููุฉ

ุนูุฏ ุชุดุบูู `setup_citizen_accounts_system.php`ุ ุชุธูุฑ ุฑุณุงูุฉ:

```
โ๏ธ ุฅูุดุงุก/ุฌูุจ ุญุณุงุจ ููุงุทู (sp_get_or_create_citizen_account) ุบูุฑ ููุฌูุฏ
โ๏ธ ุชูุธูู ุงูุฑูุงุจุท ุงูููุชููุฉ (sp_cleanup_expired_links) ุบูุฑ ููุฌูุฏ
โ๏ธ ุฅุญุตุงุฆูุงุช ุงูููุงุทู (sp_get_citizen_stats) ุบูุฑ ููุฌูุฏ
```

## โ ุงูุญู

ุชู ุฅูุดุงุก ูููุงุช ูููุตูุฉ ูุชุซุจูุช ุงูู Stored Procedures.

---

## ๐ ุฎุทูุงุช ุงูุชุซุจูุช

### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุงููุงุฌูุฉ ุงููุฑุฆูุฉ (ููุตู ุจูุง)

1. ุงูุชุญ ุงููุชุตูุญ ูุงุฐูุจ ุฅูู:
   ```
   http://localhost:8080/tekrit_municipality/INSTALL_PROCEDURES_NOW.html
   ```

2. ุงุถุบุท ุนูู ุฒุฑ **"ุงุจุฏุฃ ุงูุชุซุจูุช ุงูุขู"**

3. ุงูุชุธุฑ ุญุชู ุชุธูุฑ ุฑุณุงูุฉ ุงููุฌุงุญ โ

4. ุชุญูู ูู ุฃู ุฌููุน ุงูู Procedures ุชู ุฅูุดุงุคูุง ุจูุฌุงุญ

---

### ุงูุทุฑููุฉ 2: ุงููุตูู ุงููุจุงุดุฑ

ุงูุชุญ ุงููุชุตูุญ ูุจุงุดุฑุฉ ุนูู:
```
http://localhost:8080/tekrit_municipality/install_stored_procedures.php
```

---

### ุงูุทุฑููุฉ 3: ุงุณุชุฎุฏุงู phpMyAdmin

1. ุงูุชุญ phpMyAdmin: `http://localhost/phpmyadmin`

2. ุงุฎุชุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช `tekrit_municipality`

3. ุงุฐูุจ ุฅูู ุชุจููุจ **SQL**

4. ุงูุชุญ ุงูููู `database/stored_procedures.sql` ูู ูุญุฑุฑ ูุตูุต

5. ุงูุณุฎ ุงููุญุชูู ูุงููุงู ูุงูุตูู ูู phpMyAdmin

6. ุงุถุบุท **Go** ุฃู **ุชูููุฐ**

---

## ๐ฆ ุงููููุงุช ุงูุชู ุชู ุฅูุดุงุคูุง

### 1. `database/stored_procedures.sql`
ููู SQL ูุญุชูู ุนูู ุฌููุน ุงูู Stored Procedures:
- โ `sp_get_or_create_citizen_account` - ุฅูุดุงุก/ุฌูุจ ุญุณุงุจ ููุงุทู
- โ `sp_cleanup_expired_links` - ุชูุธูู ุงูุฑูุงุจุท ุงูููุชููุฉ
- โ `sp_get_citizen_stats` - ุฅุญุตุงุฆูุงุช ุงูููุงุทู
- โ `sp_create_magic_link` - ุฅูุดุงุก ุฑุงุจุท ุณุญุฑู
- โ `sp_validate_magic_link` - ุงูุชุญูู ูู ุงูุฑุงุจุท ุงูุณุญุฑู

### 2. `install_stored_procedures.php`
ุณูุฑูุจุช PHP ุชูุงุนูู ูุชุซุจูุช ุงูู Procedures ูุน:
- ูุงุฌูุฉ ูุฑุฆูุฉ ุฌูููุฉ
- ุชูุงุฑูุฑ ููุตูุฉ ุนู ุนูููุฉ ุงูุชุซุจูุช
- ุงุฎุชุจุงุฑ ุชููุงุฆู ููู Procedures

### 3. `INSTALL_PROCEDURES_NOW.html`
ุตูุญุฉ ุชูุฌูู ูุดุฑุญ ูููุณุชุฎุฏู

---

## ๐ ุงูุชุญูู ูู ุงูุชุซุจูุช

ุจุนุฏ ุงูุชุซุจูุชุ ููููู ุงูุชุญูู ูู ุฎูุงู:

### 1. ุงุณุชุฎุฏุงู phpMyAdmin
1. ุงูุชุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช `tekrit_municipality`
2. ุงุฐูุจ ุฅูู **Routines** ุฃู **Procedures**
3. ูุฌุจ ุฃู ุชุฑู 5 procedures

### 2. ุงุณุชุฎุฏุงู SQL
ูู ุจุชุดุบูู ูุฐุง ุงูุงุณุชุนูุงู:
```sql
SHOW PROCEDURE STATUS WHERE Db = 'tekrit_municipality';
```

### 3. ุฅุนุงุฏุฉ ุชุดุบูู ุตูุญุฉ ุงูุชุซุจูุช ุงูุฑุฆูุณูุฉ
```
http://localhost:8080/tekrit_municipality/setup_citizen_accounts_system.php
```
ูุฌุจ ุฃู ุชุฑู ุนูุงูุงุช โ ุฎุถุฑุงุก ุจุฌุงูุจ ุฌููุน ุงูู Procedures

---

## ๐งช ุงุฎุชุจุงุฑ ุงูู Procedures

### ุงุฎุชุจุงุฑ ุชูุธูู ุงูุฑูุงุจุท ุงูููุชููุฉ:
```sql
CALL sp_cleanup_expired_links();
```

### ุงุฎุชุจุงุฑ ุฅูุดุงุก ุญุณุงุจ ููุงุทู:
```sql
CALL sp_get_or_create_citizen_account(
    '03123456',
    'ูุญูุฏ ุฃุญูุฏ',
    'test@example.com',
    NULL
);
```

### ุงุฎุชุจุงุฑ ุฅูุดุงุก ุฑุงุจุท ุณุญุฑู:
```sql
CALL sp_create_magic_link(1, '03123456', 24);
```

---

## โ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### ููุงุฐุง ูู ูุชู ุชุซุจูุช ุงูู Procedures ูุน ุงูุฌุฏุงููุ

ุงูุณุจุจ: ููู SQL ุงูุฃุตูู ูุงู ูุณุชุฎุฏู `DELIMITER` ุงูุฐู ูุง ูุนูู ูุน PDO ูู PHP.

**ุงูุญู:** ุชู ูุตู ุงูู Procedures ูู ููู ูููุตู ูุฅูุดุงุก ุณูุฑูุจุช ุฎุงุต ูุชุซุจูุชูุง.

### ูู ูููู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุจุชุ

โ ูุนู! ุงูุณูุฑูุจุช ุขูู ุชูุงูุงู ููููู ุชุดุบููู ุนุฏุฉ ูุฑุงุช. ุณูููู ุจุญุฐู ุงูู Procedures ุงููุฏููุฉ ูุฅุนุงุฏุฉ ุฅูุดุงุฆูุง.

### ูู ุณูุชู ุญุฐู ุฃู ุจูุงูุงุชุ

โ ูุง! ุงูู Stored Procedures ูุง ุชุคุซุฑ ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูู ุงูุฌุฏุงูู.

---

## ๐ ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู

### ุงููุดููุฉ: ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุดุบูู XAMPP
2. ุชุฃูุฏ ูู ุชุดุบูู MySQL
3. ุชุญูู ูู ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู `install_stored_procedures.php`

### ุงููุดููุฉ: ุฎุทุฃ ูู ุชูููุฐ Procedure ูุนูู

**ุงูุญู:**
1. ุงูุชุญ `database/stored_procedures.sql`
2. ุงุจุญุซ ุนู ุงูู Procedure ุงูุฐู ูุดู
3. ุงูุณุฎู ูุฌุฑุจู ูุจุงุดุฑุฉ ูู phpMyAdmin
4. ุฑุงุฌุน ุฑุณุงูุฉ ุงูุฎุทุฃ ุงููุญุฏุฏุฉ

### ุงููุดููุฉ: ุงูู Procedures ููุฌูุฏุฉ ููู ูุง ุชุนูู

**ุงูุญู:**
```sql
-- ุญุฐู ุฌููุน ุงูู Procedures
DROP PROCEDURE IF EXISTS sp_get_or_create_citizen_account;
DROP PROCEDURE IF EXISTS sp_cleanup_expired_links;
DROP PROCEDURE IF EXISTS sp_get_citizen_stats;
DROP PROCEDURE IF EXISTS sp_create_magic_link;
DROP PROCEDURE IF EXISTS sp_validate_magic_link;

-- ุซู ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุจุช
```

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:

1. ุชุญูู ูู ุณุฌู ุงูุฃุฎุทุงุก ูู ุตูุญุฉ ุงูุชุซุจูุช
2. ุฑุงุฌุน ููู `database/stored_procedures.sql`
3. ุฌุฑุจ ุงูุชุซุจูุช ุงููุฏูู ุนุจุฑ phpMyAdmin
4. ุชุฃูุฏ ูู ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช `tekrit_municipality` ููุฌูุฏุฉ ููุดุทุฉ

---

## โ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุจุนุฏ ุงูุชุซุจูุช

ุจุนุฏ ุงูุชุซุจูุช ุงููุงุฌุญ:

1. โ ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช WhatsApp ูู:
   ```
   http://localhost:8080/tekrit_municipality/modules/whatsapp_settings.php
   ```

2. โ ูุฑุงุฌุนุฉ ุฏููู ุงูุงุณุชุฎุฏุงู:
   ```
   CITIZEN_ACCOUNTS_USER_GUIDE.md
   ```

3. โ ุงูุจุฏุก ุจุงุณุชุฎุฏุงู ุงููุธุงู!

---

๐๏ธ **ุจูุฏูุฉ ุชูุฑูุช - ุนูุงุฑุ ุดูุงู ูุจูุงู** ๐ฑ๐ง

