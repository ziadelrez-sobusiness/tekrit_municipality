# ๐๏ธ ูุธุงู ุงูุญุณุงุจ ุงูุดุฎุตู ููููุงุทู

## ุจูุฏูุฉ ุชูุฑูุช - ุนูุงุฑุ ุดูุงู ูุจูุงู ๐ฑ๐ง

[![Status](https://img.shields.io/badge/Status-Ready-brightgreen)]()
[![Version](https://img.shields.io/badge/Version-1.0-blue)]()
[![Database](https://img.shields.io/badge/Database-MySQL-orange)]()
[![PHP](https://img.shields.io/badge/PHP-7.4+-purple)]()

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

- [ูุธุฑุฉ ุนุงูุฉ](#-ูุธุฑุฉ-ุนุงูุฉ)
- [ุงููููุฒุงุช](#-ุงููููุฒุงุช)
- [ุงูุชุซุจูุช ุงูุณุฑูุน](#-ุงูุชุซุจูุช-ุงูุณุฑูุน)
- [ุงูุจููุฉ](#-ุงูุจููุฉ)
- [ุงูุงุณุชุฎุฏุงู](#-ุงูุงุณุชุฎุฏุงู)
- [ุงูุตูุงูุฉ](#-ุงูุตูุงูุฉ)
- [ุงูุชูุซูู](#-ุงูุชูุซูู)
- [ุงูุฏุนู](#-ุงูุฏุนู)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุชูุงูู ูุชูุญ ููู ููุงุทู:
- โ ุญุณุงุจ ุดุฎุตู ุชููุงุฆู ุนูุฏ ุชูุฏูู ุฃูู ุทูุจ
- โ ุฏุฎูู ุณุฑูุน ูุขูู ุนุจุฑ WhatsApp (Magic Links)
- โ ูุชุงุจุนุฉ ุฌููุน ุงูุทูุจุงุช ุงูููุฏูุฉ
- โ ุงุณุชูุจุงู ุฑุณุงุฆู ูุฅุดุนุงุฑุงุช ูู ุงูุจูุฏูุฉ
- โ ุฅุดุนุงุฑุงุช WhatsApp ูุฌุงููุฉ ููุฑูุฉ
- โ ุชุญูู ูุงูู ูู ุชูุถููุงุช ุงูุฅุดุนุงุฑุงุช

---

## โจ ุงููููุฒุงุช

### ๐ ุชุณุฌูู ุฏุฎูู ุฐูู
- **Magic Links:** ุฑูุงุจุท ูุฑูุฏุฉ ููุฏุฎูู ูู WhatsApp
- **ุตูุงุญูุฉ ูุญุฏูุฏุฉ:** 7 ุฃูุงู ุงูุชุฑุงุถูุงู
- **ุงุณุชุฎุฏุงู ููุฑุฉ ูุงุญุฏุฉ:** ุฃูุงู ุฅุถุงูู
- **ุชุณุฌูู ุชููุงุฆู:** ุญุณุงุจ ููุฑู ุนูุฏ ุฃูู ุทูุจ

### ๐ฌ ุฅุดุนุงุฑุงุช WhatsApp ูุฌุงููุฉ
- **ุจุฏูู ุชูููุฉ:** ูุง ุญุงุฌุฉ ูู SMS ูุฏููุน
- **ููุฑูุฉ:** ุฅุดุนุงุฑุงุช ูุญุธูุฉ
- **ุชูุงุนููุฉ:** ุฑูุงุจุท ูุจุงุดุฑุฉ ููุญุณุงุจ
- **ููุงูุจ ุฌุงูุฒุฉ:** ุฑุณุงุฆู ุงุญุชุฑุงููุฉ

### ๐ ุชุชุจุน ุดุงูู
- **ุฌููุน ุงูุทูุจุงุช:** ูู ููุงู ูุงุญุฏ
- **ุงูุฑุณุงุฆู:** ูู ุงูุจูุฏูุฉ
- **ุงูุฅุญุตุงุฆูุงุช:** ุชูุงุฑูุฑ ุชูุตูููุฉ
- **ุงูุชุงุฑูุฎ:** ุณุฌู ูุงูู

### ๐ก๏ธ ุฃูุงู ุนุงูู
- **ุชุดููุฑ:** ุฑูุงุจุท ูุดูุฑุฉ
- **ุชุณุฌูู IP:** ููู ุนูููุฉ
- **ุงูุชูุงุก ุชููุงุฆู:** ููุฌูุณุงุช
- **Foreign Keys:** ุญูุงูุฉ ุงูุจูุงูุงุช

---

## ๐ ุงูุชุซุจูุช ุงูุณุฑูุน

### ุงูุทุฑููุฉ 1: ุนุจุฑ ุงููุงุฌูุฉ (ููุตู ุจูุง)

```
1. ุงูุชุญ ุงููุชุตูุญ
2. ุงุฐูุจ ุฅูู: http://localhost:8080/tekrit_municipality/setup_citizen_accounts_system.php
3. ุงุถุบุท "ุชูููุฐ"
4. ุชุญูู ูู ุงููุฌุงุญ
```

### ุงูุทุฑููุฉ 2: ุนุจุฑ phpMyAdmin

```
1. ุงูุชุญ phpMyAdmin
2. ุงุฎุชุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช: tekrit_municipality
3. ุงุฐูุจ ุฅูู ุชุจููุจ "SQL"
4. ุงุณุชูุฑุฏ: database/citizen_accounts_system.sql
5. ุงุถุบุท "ุชูููุฐ"
```

### ุงูุทุฑููุฉ 3: ุณุทุฑ ุงูุฃูุงูุฑ

```bash
mysql -u root -p tekrit_municipality < database/citizen_accounts_system.sql
```

---

## ๐ ุงูุจููุฉ

### ุงูุฌุฏุงูู (6)

| ุงูุฌุฏูู | ุงูุฃุนูุฏุฉ | ุงููุตู |
|--------|---------|-------|
| `citizens_accounts` | 12 | ุญุณุงุจุงุช ุงูููุงุทููู |
| `magic_links` | 10 | ุฑูุงุจุท ุงูุฏุฎูู ุงูุณุญุฑูุฉ |
| `citizen_messages` | 13 | ุฑุณุงุฆู ุงูุจูุฏูุฉ |
| `whatsapp_log` | 12 | ุณุฌู WhatsApp |
| `notification_preferences` | 9 | ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช |
| `citizen_sessions` | 8 | ุฌูุณุงุช ุงูุฏุฎูู |

### Views (3)

- `v_citizens_summary` - ููุฎุต ุงูููุงุทููู
- `v_citizen_messages_detailed` - ุงูุฑุณุงุฆู ุงูุชูุตูููุฉ
- `v_whatsapp_log_detailed` - ุณุฌู WhatsApp ุงูุชูุตููู

### Stored Procedures (3)

- `sp_get_or_create_citizen_account` - ุฅูุดุงุก/ุฌูุจ ุญุณุงุจ
- `sp_cleanup_expired_links` - ุชูุธูู ุงูุฑูุงุจุท
- `sp_get_citizen_stats` - ุฅุญุตุงุฆูุงุช ุงูููุงุทู

### Triggers (2)

- `tr_update_login_count` - ุชุญุฏูุซ ุนุฏุงุฏ ุงูุฏุฎูู
- `tr_log_citizen_message` - ุชุณุฌูู WhatsApp ุชููุงุฆู

---

## ๐ป ุงูุงุณุชุฎุฏุงู

### ุฅูุดุงุก ุญุณุงุจ ููุงุทู

```sql
CALL sp_get_or_create_citizen_account(
    '96103123456',
    'ุฃุญูุฏ ูุญูุฏ',
    'ahmad@example.com',
    'ุชูุฑูุช - ุนูุงุฑ',
    '123456789'
);
```

### ุฅุฑุณุงู ุฑุณุงูุฉ

```sql
INSERT INTO citizen_messages (
    citizen_id,
    message_type,
    title,
    message,
    priority,
    sent_via_whatsapp
) VALUES (
    1,
    'ุฅุดุนุงุฑ',
    'ุชุญุฏูุซ ุนูู ุทูุจู',
    'ุชู ูุฑุงุฌุนุฉ ุทูุจู',
    'ููู',
    1
);
```

### ุฅูุดุงุก Magic Link

```sql
INSERT INTO magic_links (citizen_id, token, phone, expires_at)
SELECT 
    id,
    SHA2(CONCAT(phone, NOW(), RAND()), 256),
    phone,
    DATE_ADD(NOW(), INTERVAL 7 DAY)
FROM citizens_accounts 
WHERE phone = '96103123456';
```

### ุนุฑุถ ุฅุญุตุงุฆูุงุช

```sql
CALL sp_get_citizen_stats(1);
```

---

## ๐งน ุงูุตูุงูุฉ

### ููููุงู (Cron Job)

```sql
CALL sp_cleanup_expired_links();
```

ุฃู ุนุจุฑ Cron:

```bash
0 2 * * * mysql -u root -p tekrit_municipality -e "CALL sp_cleanup_expired_links();"
```

### ุฃุณุจูุนูุงู

```sql
ANALYZE TABLE 
    citizens_accounts,
    magic_links,
    citizen_messages,
    whatsapp_log;
```

### ุดูุฑูุงู (ุงุฎุชูุงุฑู)

```sql
-- ุฃุฑุดูุฉ ุงูุฑุณุงุฆู ุงููุฏููุฉ
DELETE FROM citizen_messages 
WHERE is_read = 1 
AND created_at < DATE_SUB(NOW(), INTERVAL 6 MONTH);

-- ุฃุฑุดูุฉ ุณุฌู WhatsApp
DELETE FROM whatsapp_log 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 6 MONTH);
```

---

## ๐ ุงูุชูุซูู

### ุงููููุงุช ุงูุฑุฆูุณูุฉ

| ุงูููู | ุงููุตู |
|-------|-------|
| [CITIZEN_ACCOUNTS_DATABASE_DOCUMENTATION.md](CITIZEN_ACCOUNTS_DATABASE_DOCUMENTATION.md) | ุงูุชูุซูู ุงููุงูู |
| [CITIZEN_ACCOUNTS_SETUP_README.md](CITIZEN_ACCOUNTS_SETUP_README.md) | ุฏููู ุงูุชุซุจูุช ุงูุณุฑูุน |
| [DATABASE_UPDATE_SUMMARY.md](DATABASE_UPDATE_SUMMARY.md) | ููุฎุต ุงูุชุญุฏูุซุงุช |
| [database/DATABASE_SCHEMA_DIAGRAM.md](database/DATABASE_SCHEMA_DIAGRAM.md) | ูุฎุทุทุงุช ุจุตุฑูุฉ |
| [database/QUICK_SQL_REFERENCE.sql](database/QUICK_SQL_REFERENCE.sql) | 30 ุงุณุชุนูุงู ูููุฏ |

### ุงููููุงุช ุงูุชูููุฉ

| ุงูููู | ุงููุตู |
|-------|-------|
| `database/citizen_accounts_system.sql` | ุงูุณูุฑูุจุช ุงููุงูู |
| `database/test_queries.sql` | 18 ุงุฎุชุจุงุฑ ุดุงูู |
| `setup_citizen_accounts_system.php` | ุตูุญุฉ ุงูุชุซุจูุช |
| `DATABASE_SETUP_COMPLETE.html` | ุตูุญุฉ ุชูุงุนููุฉ |

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช

```bash
mysql -u root -p tekrit_municipality < database/test_queries.sql
```

### ุงูุงุฎุชุจุงุฑุงุช ุงููุชุถููุฉ

- โ ุงูุชุญูู ูู ุงูุฌุฏุงูู (6)
- โ ุงูุชุญูู ูู ุงูุฃุนูุฏุฉ ูุงูููุงุฑุณ
- โ ุงูุชุญูู ูู ุงูุนูุงูุงุช
- โ ุงุฎุชุจุงุฑ Views (3)
- โ ุงุฎุชุจุงุฑ Stored Procedures (3)
- โ ุงุฎุชุจุงุฑ Triggers (2)
- โ ุงุฎุชุจุงุฑ ุฅูุดุงุก ุญุณุงุจ
- โ ุงุฎุชุจุงุฑ Magic Links
- โ ุงุฎุชุจุงุฑ ุงูุฑุณุงุฆู
- โ ุงุฎุชุจุงุฑ WhatsApp Log
- โ ุงุฎุชุจุงุฑ ุงูุฌูุณุงุช
- โ ุงุฎุชุจุงุฑ ุงูุชูุธูู
- โ ุฅุญุตุงุฆูุงุช ุนุงูุฉ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ูุง ุชู ุฅูุดุงุคู

- **6** ุฌุฏุงูู ุฌุฏูุฏุฉ
- **60+** ุนููุฏ
- **27** ููุฑุณ (Index)
- **8** ุนูุงูุงุช (Foreign Keys)
- **3** Views
- **3** Stored Procedures
- **2** Triggers
- **10** ุฅุนุฏุงุฏุงุช WhatsApp

### ุงูุญุฌู ุงููุชููุน

| ุงูููุงุทููู | ุงูุญุฌู |
|-----------|-------|
| 100 | ~1 MB |
| 1,000 | ~10 MB |
| 10,000 | ~100 MB |

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ุงููุฑุญูุฉ 3: ูููุงุช PHP

- [ ] `includes/CitizenAccount.php`
- [ ] `includes/WhatsAppHelper.php`
- [ ] `includes/MagicLink.php`
- [ ] `public/my-account-login.php`
- [ ] `public/my-account.php`
- [ ] ุชุญุฏูุซ `public/citizen-requests.php`

### ุงููุฑุญูุฉ 4: ุงููุงุฌูุงุช ุงูุฅุฏุงุฑูุฉ

- [ ] `modules/citizens_management.php`
- [ ] `modules/send_whatsapp_messages.php`
- [ ] `modules/whatsapp_log_viewer.php`

### ุงููุฑุญูุฉ 5: ุงูุงุฎุชุจุงุฑ ูุงูุชุดุบูู

- [ ] ุงุฎุชุจุงุฑ ุงูุชุณุฌูู ุงูุชููุงุฆู
- [ ] ุงุฎุชุจุงุฑ Magic Links
- [ ] ุงุฎุชุจุงุฑ ุฅุฑุณุงู WhatsApp
- [ ] ุงุฎุชุจุงุฑ ุงูุตูุญุฉ ุงูุดุฎุตูุฉ
- [ ] ุงูุชุดุบูู ุงูุชุฌุฑูุจู

---

## ๐ ุงูุฃูุงู

### ุงูุฅุฌุฑุงุกุงุช ุงููุทุจูุฉ

โ **Foreign Keys** ูุน CASCADE/SET NULL  
โ **ููุงุฑุณ** ุนูู ุฌููุน ุงูุฃุนูุฏุฉ ุงูุญุณุงุณุฉ  
โ **Magic Links** ุจุตูุงุญูุฉ ูุญุฏูุฏุฉ  
โ **ุงุณุชุฎุฏุงู ููุฑุฉ ูุงุญุฏุฉ** ููุฑูุงุจุท  
โ **ุชุณุฌูู IP** ู User Agent  
โ **ุงูุชูุงุก ุชููุงุฆู** ููุฌูุณุงุช  
โ **ุชุดููุฑ UTF-8** ูุฌููุน ุงูุฌุฏุงูู  

---

## ๐ ุงูุฏุนู

### ุงูุงุชุตุงู

- ๐ง **ุงูุจุฑูุฏ:** support@tekrit.gov.lb
- ๐ฑ **ุงููุงุชู:** 06-123-456
- ๐๏ธ **ุงูุนููุงู:** ุจูุฏูุฉ ุชูุฑูุช - ุนูุงุฑุ ุดูุงู ูุจูุงู

### ุงููุณุงุนุฏุฉ

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุช:
1. ุฑุงุฌุน [ุงูุชูุซูู ุงููุงูู](CITIZEN_ACCOUNTS_DATABASE_DOCUMENTATION.md)
2. ุฑุงุฌุน [ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ](#-ุฃุณุฆูุฉ-ุดุงุฆุนุฉ)
3. ุงุชุตู ุจุงูุฏุนู ุงูููู

---

## โ ุฃุณุฆูุฉ ุดุงุฆุนุฉ

### ููู ุฃุจุฏุฃ ุงูุชุซุจูุชุ

ุงูุชุญ: `http://localhost:8080/tekrit_municipality/setup_citizen_accounts_system.php`

### ูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุขููุฉุ

ูุนูุ ุงูุณูุฑูุจุช ูุง ูุญุฐู ุฃู ุจูุงูุงุช ููุฌูุฏุฉ.

### ููู ุฃุฎุชุจุฑ ุงููุธุงูุ

ุดุบูู: `database/test_queries.sql`

### ูู WhatsApp ูุฌุงููุ

ูุนูุ ูููู ุงุณุชุฎุฏุงู WhatsApp Business ูุฌุงูุงู.

### ููู ุฃุนุทู ุญุณุงุจ ููุงุทูุ

```sql
UPDATE citizens_accounts 
SET is_active = 0 
WHERE phone = '96103123456';
```

### ููู ุฃุฑุณู ุฑุณุงูุฉ ูุฌููุน ุงูููุงุทูููุ

```sql
INSERT INTO citizen_messages (citizen_id, message_type, title, message, sent_via_whatsapp)
SELECT id, 'ุนุงู', 'ุงูุนููุงู', 'ุงููุต', 1
FROM citizens_accounts 
WHERE is_active = 1;
```

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุธุงู ูุทูุฑ ุฎุตูุตุงู ูุจูุฏูุฉ ุชูุฑูุช - ุนูุงุฑุ ุดูุงู ูุจูุงู.

---

## ๐ ุดูุฑ ูุชูุฏูุฑ

ุชู ุชุทููุฑ ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ AI Assistant ูุฎุฏูุฉ ููุงุทูู ุจูุฏูุฉ ุชูุฑูุช.

---

## ๐ ุณุฌู ุงูุชุญุฏูุซุงุช

### ุงูุฅุตุฏุงุฑ 1.0 (2025-11-10)

- โ ุฅูุดุงุก 6 ุฌุฏุงูู ุฑุฆูุณูุฉ
- โ ุฅุถุงูุฉ 3 Views
- โ ุฅุถุงูุฉ 3 Stored Procedures
- โ ุฅุถุงูุฉ 2 Triggers
- โ ุฅุถุงูุฉ 10 ุฅุนุฏุงุฏุงุช WhatsApp
- โ ุชูุซูู ุดุงูู
- โ 18 ุงุฎุชุจุงุฑ
- โ 30 ุงุณุชุนูุงู ูููุฏ

---

## ๐ ุฌุงูุฒ ููุจุฏุก!

### ุงูุฎุทูุฉ ุงูุชุงููุฉ

ุงูุชุญ ุงููุชุตูุญ ุงูุขู:

๐ **http://localhost:8080/tekrit_municipality/setup_citizen_accounts_system.php**

ุฃู ุงูุชุญ ุงูุตูุญุฉ ุงูุชูุงุนููุฉ:

๐ **http://localhost:8080/tekrit_municipality/DATABASE_SETUP_COMPLETE.html**

---

<div align="center">

**๐๏ธ ุจูุฏูุฉ ุชูุฑูุช - ุนูุงุฑุ ุดูุงู ูุจูุงู ๐ฑ๐ง**

*ูุธุงู ุฅุฏุงุฑุฉ ุงูุจูุฏูุฉ ุงูุฅููุชุฑููู*

[![Made with โค๏ธ](https://img.shields.io/badge/Made%20with-โค๏ธ-red)]()
[![For Citizens](https://img.shields.io/badge/For-Citizens-blue)]()
[![Lebanon](https://img.shields.io/badge/Lebanon-๐ฑ๐ง-green)]()

</div>

